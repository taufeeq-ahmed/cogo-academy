---
import Dashboard from "../components/Dashboard.astro";
import Header from "../components/Header/Header";

import DashLayout from "../layouts/DashLayout.astro";
import { fetchData } from "../utils/common";

const token = Astro?.request?.headers?.get("cookie")?.split("=")[1];

const data = await fetchData("user-dashboard", token);
if (!data) {
  return Astro.redirect("/signin");
}
---

<DashLayout title="Home - Dashboard" selected={"/"} courses={data?.allCourses}>
  <Header
    slot="header"
    text={`Welcome back ${data?.userData?.user_name}`}
    user={data?.userData}
    client:load
  />
  <Dashboard data={data} />
</DashLayout>

<style>
  .container_body {
    display: flex;
    flex-wrap: wrap;
    overflow: auto;
    gap: 20px;
    padding: 5px;
  }
</style>

<!-- <script>
  const parseCookie = (str) =>
    str
      .split(";")
      .map((v) => v.split("="))
      .reduce((acc, v) => {
        acc[decodeURIComponent(v[0].trim())] = decodeURIComponent(v[1].trim());
        return acc;
      }, {});
  if (!parseCookie(document.cookie).auth) {
    window.location = "/login";
  }
</script> -->
