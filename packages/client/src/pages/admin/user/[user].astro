---
import AdminUserHeader from "../../../components/AdminUserHeader/AdminUserHeader";
import EditCourse from "../../../components/EditCourse/EditCourse";
import ProgressOverview from "../../../components/ProgressOverview/ProgressOverview";
import Table from "../../../components/Table/Table";
import AdminLayout from "../../../layouts/AdminLayout.astro";
import { fetchData } from "../../../utils/common";
const { user } = Astro.params;
const token = Astro?.request?.headers?.get("cookie")?.split("=")[1];
if (!token) {
    return Astro.redirect("/signin");
}
const data = await fetchData(`admin/user/${user}`, token);
if (!data) return Astro.redirect("/error");


const formatTableData = () => {
    const tableData = {
        head: ["Title", "Section", "Course", "Score", "Action"],
        rows: data.readArticles.map((article) => {
            const newArticle = [
                { name: article?.article?.article_name },
                { name: article?.article?.section?.section_name },
                { name: article?.article?.section?.course?.course_name },
                { name: article?.score },
            ];
            return newArticle;
        }),
    };
    return tableData;
};
---

<AdminLayout title="Admin | User Profile Page">
    <AdminUserHeader client:load userData={data.studentData} />
    <ProgressOverview client:load progressData={data} />
    <Table data={formatTableData()} />
    <!-- <EditCourse client:load /> -->
</AdminLayout>

<style></style>
